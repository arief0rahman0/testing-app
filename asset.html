<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyIT-Inventory</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .card { background-color: #1e293b; border: 1px solid #334155; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .active-nav { background-color: #0ea5e9; color: white; }
        .modal-bg { background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(4px); }
        .transition-all { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        input, select { background-color: #0f172a !important; border-color: #334155 !important; color: white !important; }
        input:focus, select:focus { border-color: #0ea5e9 !important; outline: 2px solid rgba(14, 165, 233, 0.3) !important; }
        
        .modal-content { transform: scale(0.95); opacity: 0; transition: all 0.3s ease-out; }
        .modal-content.modal-open { transform: scale(1); opacity: 1; }
        
        .notification-badge { position: absolute; top: -2px; right: -2px; background-color: #ef4444; color: white; font-size: 0.6rem; width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #1e293b; }
        .dropdown-menu { opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.2s ease-in-out; }
        .group:hover .dropdown-menu { opacity: 1; visibility: visible; transform: translateY(0); }
        .hidden { display: none !important; }
        .chart-container { position: relative; width: 100%; height: 250px; }
    </style>
</head>
<body>

    <!-- ================= LOGIN PAGE ================= -->
    <div id="login-page" class="min-h-screen flex items-center justify-center bg-slate-900 p-4">
        <div class="card p-8 rounded-3xl w-full max-w-sm shadow-2xl border-slate-700 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-sky-500/10 rounded-full blur-3xl -mr-16 -mt-16"></div>
            <div class="text-center mb-8 relative z-10">
                <div class="bg-sky-500 w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-sky-500/30">
                    <i data-lucide="shield-check" class="text-white w-8 h-8"></i>
                </div>
                <h1 class="text-2xl font-black text-white tracking-tight">MyIT Login</h1>
                <p class="text-slate-400 text-sm mt-2">Masuk untuk mengelola inventaris</p>
            </div>
            <form id="login-form" class="space-y-5 relative z-10">
                <div class="space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Username</label><div class="relative"><i data-lucide="user" class="absolute left-3 top-3.5 w-4 h-4 text-slate-500"></i><input type="text" id="login-username" class="w-full pl-10 p-3 rounded-xl border text-sm focus:border-sky-500 transition-colors" placeholder="admin" required></div></div>
                <div class="space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Password</label><div class="relative"><i data-lucide="lock" class="absolute left-3 top-3.5 w-4 h-4 text-slate-500"></i><input type="password" id="login-password" class="w-full pl-10 p-3 rounded-xl border text-sm focus:border-sky-500 transition-colors" placeholder="••••••" required></div></div>
                <button type="submit" class="w-full py-3 bg-sky-600 hover:bg-sky-500 text-white font-bold rounded-xl shadow-lg shadow-sky-500/20 transition transform hover:-translate-y-0.5 active:translate-y-0">Masuk Aplikasi</button>
            </form>
            <div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-700"></div></div><div class="relative flex justify-center text-[10px] uppercase font-bold tracking-widest"><span class="bg-slate-900 px-2 text-slate-500">Atau masuk dengan</span></div></div>
            <div class="grid grid-cols-2 gap-3 relative z-10">
                <button onclick="mockLogin('google')" class="flex items-center justify-center gap-2 bg-white text-slate-900 py-2.5 rounded-xl font-bold text-xs hover:bg-gray-100 transition shadow-lg transform hover:-translate-y-0.5"><svg class="w-4 h-4" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>Google</button>
                <button onclick="mockLogin('sso')" class="flex items-center justify-center gap-2 bg-indigo-600 text-white py-2.5 rounded-xl font-bold text-xs hover:bg-indigo-500 transition shadow-lg shadow-indigo-500/20 transform hover:-translate-y-0.5"><i data-lucide="key-round" class="w-3.5 h-3.5"></i> SSO Login</button>
            </div>
            <div id="login-error" class="bg-red-500/10 border border-red-500/20 text-red-400 p-3 rounded-xl text-center text-xs mt-6 hidden font-medium"></div>
            <div class="mt-8 pt-6 border-t border-slate-700/50 text-center text-[10px] text-slate-400 font-mono">admin/admin123 • staff/staff123 • viewer/viewer123</div>
        </div>
    </div>

    <!-- ================= MAIN APP ================= -->
    <div id="main-app" class="grid grid-cols-1 md:grid-cols-[260px_1fr] min-h-screen hidden transition-opacity duration-500">
        <!-- Sidebar -->
        <aside class="p-6 bg-slate-900 border-r border-slate-800 flex flex-col fixed md:relative h-full z-40 w-64">
            <div class="mb-10 flex items-center space-x-3">
                <div class="bg-sky-500 p-2 rounded-lg shadow-lg shadow-sky-500/30">
                    <i data-lucide="shield-check" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black text-white tracking-tight">MyIT-INV</h1>
                    <div id="current-user-role" class="text-[9px] text-sky-400 uppercase tracking-widest font-black bg-sky-900/30 px-1.5 py-0.5 rounded inline-block mt-1">LOADING...</div>
                </div>
            </div>
            
            <nav class="space-y-2 flex-grow">
                <div class="text-[10px] uppercase font-bold text-slate-500 px-3 mb-2">Menu Utama</div>
                
                <!-- Menu Dashboard -->
                <button onclick="switchView('dashboard')" id="nav-dashboard" class="w-full flex items-center space-x-3 p-3 rounded-xl active-nav transition-all text-left group">
                    <i data-lucide="layout-grid" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    <span class="font-bold text-sm">Dashboard</span>
                </button>
                
                <!-- Menu Data Aset -->
                <button onclick="switchView('assets')" id="nav-assets" class="w-full flex items-center space-x-3 p-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all text-left group">
                    <i data-lucide="list" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    <span class="font-bold text-sm">Data Aset</span>
                </button>

                <!-- NEW: Menu Laporan -->
                <button onclick="switchView('report')" id="nav-report" class="w-full flex items-center space-x-3 p-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all text-left group">
                    <i data-lucide="bar-chart-3" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    <span class="font-bold text-sm">Laporan Analisis</span>
                </button>
                
                <div class="role-superadmin hidden mt-6">
                    <div class="text-[10px] uppercase font-bold text-slate-500 px-3 mb-2">Admin Zone</div>
                    <button onclick="switchView('users')" id="nav-users" class="w-full flex items-center space-x-3 p-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-purple-400 transition-all text-left group">
                        <i data-lucide="users" class="w-5 h-5 group-hover:scale-110 transition-transform text-purple-500"></i>
                        <span class="font-bold text-sm">Manajemen User</span>
                    </button>
                </div>
            </nav>

            <div class="mt-auto pt-6 border-t border-slate-800">
                <div class="flex items-center gap-3 mb-4 px-2 bg-slate-800/50 p-2 rounded-xl border border-slate-700/50">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-sky-500 to-indigo-500 flex items-center justify-center text-xs font-bold text-white shadow-lg" id="user-initial">U</div>
                    <div class="overflow-hidden">
                        <p class="text-sm font-bold text-white truncate" id="user-name">User</p>
                        <div class="flex items-center gap-1.5"><span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></span><p class="text-[10px] text-slate-400 truncate">Online</p></div>
                    </div>
                </div>
                <button onclick="logout()" class="w-full py-2.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-xl text-xs font-bold flex items-center justify-center space-x-2 transition border border-red-500/20 hover:border-red-500/40">
                    <i data-lucide="log-out" class="w-3.5 h-3.5"></i><span>Keluar</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="p-6 md:p-10 overflow-y-auto relative h-screen">
            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-black text-white tracking-tight" id="page-title">Dashboard</h2>
                    <p class="text-slate-400 text-sm mt-1">Sistem Informasi Manajemen Aset</p>
                </div>
                <div class="relative cursor-pointer hover:scale-105 transition" onclick="openModal('notification-modal')">
                    <div class="p-3 bg-slate-800 rounded-xl hover:bg-slate-700 transition border border-slate-700"><i data-lucide="bell" class="w-5 h-5 text-slate-300"></i></div>
                    <div id="notif-badge" class="notification-badge hidden">0</div>
                </div>
            </header>

            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="space-y-6 animate-fade-in">
                <div class="grid grid-cols-1 gap-6">
                    <div class="card p-6 rounded-2xl border-l-4 border-l-sky-500 relative overflow-hidden group hover:bg-slate-800/50 transition">
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-2">Total Aset Aktif</div>
                        <div class="text-5xl font-black text-white tracking-tighter" id="stat-total">0</div>
                        <i data-lucide="server" class="absolute right-4 bottom-4 text-sky-500/10 w-24 h-24 group-hover:scale-110 transition-transform"></i>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card p-6 rounded-2xl">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Distribusi Kategori</h3>
                        <div class="h-64 flex justify-center"><canvas id="categoryChart"></canvas></div>
                    </div>
                    <div class="card p-6 rounded-2xl">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2"><i data-lucide="alert-triangle" class="text-amber-500 w-4 h-4"></i> Peringatan Garansi (30 Hari)</h3>
                        <div id="warranty-list-dashboard" class="space-y-3 overflow-y-auto flex-grow h-64 pr-2 custom-scrollbar"><div class="text-center text-slate-500 text-sm py-10">Memuat data...</div></div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LIST ASET -->
            <div id="view-assets" class="hidden animate-fade-in">
                <div class="card p-4 rounded-2xl mb-6 flex flex-col md:flex-row gap-4 justify-between items-center bg-slate-800/50 backdrop-blur-md sticky top-0 z-20">
                    <div class="relative w-full md:w-80">
                        <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-slate-500"></i>
                        <input type="text" id="search-input" onkeyup="filterAssets()" placeholder="Cari aset..." class="w-full pl-10 pr-4 py-2 rounded-xl text-sm border bg-slate-900 border-slate-700 focus:border-sky-500 transition-colors">
                    </div>
                    <div class="flex gap-2 relative">
                        <div class="role-editable hidden flex gap-2">
                            <button onclick="openModal('import-modal')" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2 transition shadow-lg shadow-indigo-500/20">
                                <i data-lucide="arrow-down-to-line" class="w-3.5 h-3.5"></i> Import Barang Masuk (CSV)
                            </button>
                            <button onclick="openModal('edit-modal', true)" class="bg-sky-600 hover:bg-sky-500 text-white px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2 transition shadow-lg shadow-sky-500/20">
                                <i data-lucide="plus" class="w-3.5 h-3.5"></i> Tambah
                            </button>
                        </div>
                        <button onclick="exportCSV('all')" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2 transition border border-slate-600">
                            <i data-lucide="download" class="w-3.5 h-3.5"></i> Export CSV
                        </button>
                    </div>
                </div>
                <div class="card rounded-2xl overflow-hidden shadow-xl border-0">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-800 text-slate-400 text-[10px] font-black uppercase tracking-widest sticky top-0">
                                <tr>
                                    <th class="p-5">Aset</th>
                                    <th class="p-5">Kategori</th>
                                    <th class="p-5">Lokasi & Pengguna</th>
                                    <th class="p-5 text-center">Status</th>
                                    <th class="p-5 text-right role-editable hidden">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="assets-list" class="divide-y divide-slate-800/50 text-sm"></tbody>
                        </table>
                    </div>
                    <div class="p-4 border-t border-slate-800 bg-slate-900/30 flex justify-between items-center">
                        <span class="text-xs text-slate-400">Halaman <span id="curr-page">1</span></span>
                        <div class="flex gap-2">
                            <button onclick="prevPage()" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                            <button onclick="nextPage()" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LAPORAN ANALISIS (NEW) -->
            <div id="view-report" class="hidden animate-fade-in space-y-6">
                <!-- KPI Cards Report -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="card p-6 rounded-2xl border-t-4 border-teal-500">
                        <p class="text-xs text-slate-400 uppercase tracking-widest">Total Aset</p>
                        <h2 class="text-3xl font-black text-white mt-1" id="rep-total">...</h2>
                    </div>
                    <div class="card p-6 rounded-2xl border-t-4 border-indigo-500">
                        <p class="text-xs text-slate-400 uppercase tracking-widest">Estimasi Valuasi</p>
                        <h2 class="text-3xl font-black text-white mt-1" id="rep-value">...</h2>
                        <p class="text-[10px] text-slate-500 mt-1">*Asumsi Rp 5jt/aset</p>
                    </div>
                    <div class="card p-6 rounded-2xl border-t-4 border-amber-500">
                        <p class="text-xs text-slate-400 uppercase tracking-widest">Risiko Garansi</p>
                        <h2 class="text-3xl font-black text-white mt-1" id="rep-warranty">...</h2>
                    </div>
                    <div class="card p-6 rounded-2xl border-t-4 border-rose-500">
                        <p class="text-xs text-slate-400 uppercase tracking-widest">Aset Disposed</p>
                        <h2 class="text-3xl font-black text-white mt-1" id="rep-disposed">...</h2>
                    </div>
                </div>

                <!-- Wawasan Otomatis -->
                <div class="card p-6 rounded-2xl bg-gradient-to-r from-slate-900 to-slate-800 border-l-4 border-teal-500">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2"><i data-lucide="lightbulb" class="text-yellow-400 w-5 h-5"></i> Wawasan Utama</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-slate-300 leading-relaxed">
                        <div>
                            <p class="mb-2"><strong class="text-white">Dominasi Kategori:</strong> Infrastruktur didominasi oleh <span id="insight-cat" class="text-teal-400 font-bold">...</span>.</p>
                            <p><strong class="text-white">Kesehatan Aset:</strong> <span id="insight-health" class="text-emerald-400 font-bold">...</span> dari aset berstatus 'In Use'.</p>
                        </div>
                        <div>
                            <p class="mb-2"><strong class="text-white">Lokasi Terpadat:</strong> Aset paling banyak terkonsentrasi di <span id="insight-loc" class="text-rose-400 font-bold">...</span>.</p>
                            <p><strong class="text-white">Rekomendasi:</strong> Periksa aset dengan garansi habis untuk perencanaan peremajaan.</p>
                        </div>
                    </div>
                </div>

                <!-- Grafik Report -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card p-6 rounded-2xl">
                        <h3 class="text-sm font-bold text-slate-400 uppercase mb-4">Komposisi Kategori</h3>
                        <div class="chart-container"><canvas id="repChartCat"></canvas></div>
                    </div>
                    <div class="card p-6 rounded-2xl">
                        <h3 class="text-sm font-bold text-slate-400 uppercase mb-4">Status Operasional</h3>
                        <div class="chart-container"><canvas id="repChartStat"></canvas></div>
                    </div>
                    <div class="card p-6 rounded-2xl lg:col-span-2">
                        <h3 class="text-sm font-bold text-slate-400 uppercase mb-4">Tren Tahun Pembelian</h3>
                        <div class="chart-container"><canvas id="repChartTrend"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- VIEW: USER MANAGEMENT -->
            <div id="view-users" class="hidden animate-fade-in">
                <div class="card p-6 rounded-2xl mb-6 border-l-4 border-l-purple-500 bg-gradient-to-r from-slate-900 to-purple-900/20">
                    <h3 class="text-lg font-bold text-white mb-1">Manajemen Pengguna</h3>
                    <p class="text-xs text-slate-400">Kelola akses pengguna.</p>
                </div>
                <div class="card p-6 rounded-2xl mb-6">
                    <form id="user-form" class="flex flex-col md:flex-row gap-4 items-end">
                        <div class="flex-1 w-full space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Username</label><input type="text" id="new-username" required class="w-full p-2.5 rounded-xl border text-sm"></div>
                        <div class="flex-1 w-full space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Password</label><input type="password" id="new-password" required class="w-full p-2.5 rounded-xl border text-sm"></div>
                        <div class="w-full md:w-48 space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Role</label>
                            <select id="new-role" class="w-full p-2.5 rounded-xl border text-sm cursor-pointer"><option value="editor">Staff (Edit)</option><option value="viewer">Viewer (Read Only)</option><option value="superadmin">Superadmin</option></select>
                        </div>
                        <button type="submit" class="w-full md:w-auto bg-purple-600 hover:bg-purple-500 text-white px-6 py-2.5 rounded-xl font-bold text-sm transition">Buat Akun</button>
                    </form>
                </div>
                <div class="card rounded-2xl overflow-hidden shadow-xl border-0">
                    <table class="w-full text-left"><thead class="bg-slate-800 text-slate-400 text-[10px] font-black uppercase tracking-widest"><tr><th class="p-5">Pengguna</th><th class="p-5">Role</th><th class="p-5">Dibuat Pada</th><th class="p-5 text-right">Aksi</th></tr></thead><tbody id="users-list" class="divide-y divide-slate-800/50 text-sm"></tbody></table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals untuk Asset -->
    <div id="edit-modal" class="modal-bg fixed inset-0 flex items-center justify-center hidden p-4 z-[2000]">
        <div class="card p-8 rounded-3xl max-w-2xl w-full modal-content border-slate-700 shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <h3 class="text-xl font-bold mb-6 text-white flex items-center space-x-2 border-b border-slate-700 pb-4"><i data-lucide="edit-3" class="text-sky-500"></i><span id="modal-title">Edit Aset</span></h3>
            <form id="asset-form" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <input type="hidden" id="edit-id">
                <input type="text" id="edit-name" required class="w-full p-3 rounded-xl border text-sm" placeholder="Nama Aset">
                <input type="text" id="edit-sn" required class="w-full p-3 rounded-xl border text-sm font-mono" placeholder="Serial Number">
                <select id="edit-category" class="w-full p-3 rounded-xl border text-sm">
                    <option value="Laptop">Laptop</option><option value="Desktop">Desktop</option><option value="Server">Server</option><option value="Network">Network</option><option value="Printer">Printer</option><option value="Software License">Software License</option>
                </select>
                <div class="space-y-1">
                    <input type="text" id="edit-location" list="location-list" required class="w-full p-3 rounded-xl border text-sm" placeholder="Pilih atau Ketik Lokasi">
                    <datalist id="location-list"><option value="Gudang Utama"><option value="Ruang Server"><option value="Lobby"><option value="Lantai 1"><option value="Lantai 2"><option value="Lantai 3"><option value="Ruang Meeting"></datalist>
                </div>
                <input type="text" id="edit-user" class="w-full p-3 rounded-xl border text-sm" placeholder="Pengguna">
                <input type="email" id="edit-email" class="w-full p-3 rounded-xl border text-sm" placeholder="Email">
                <div class="space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Tgl Beli</label><input type="date" id="edit-purchase-date" class="w-full p-3 rounded-xl border text-sm text-slate-300"></div>
                <div class="space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Tgl Pinjam</label><input type="date" id="edit-loan-date" class="w-full p-3 rounded-xl border text-sm text-slate-300"></div>
                <div class="space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Garansi Berakhir</label><input type="date" id="edit-warranty-date" class="w-full p-3 rounded-xl border text-sm text-slate-300"></div>
                <select id="edit-status" class="w-full p-3 rounded-xl border text-sm"><option value="In Use">In Use</option><option value="Maintenance">Maintenance</option><option value="Disposed">Disposed</option></select>
                <div class="col-span-full flex gap-3 mt-4"><button type="button" onclick="closeModal('edit-modal')" class="flex-1 py-3 bg-slate-800 rounded-xl font-bold text-sm">Batal</button><button type="submit" class="flex-1 py-3 bg-sky-500 hover:bg-sky-400 text-slate-900 font-black rounded-xl text-sm">Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="modal-bg fixed inset-0 flex items-center justify-center hidden p-4 z-[2000]">
        <div class="card p-8 rounded-3xl max-w-md w-full modal-content border-slate-700 shadow-2xl">
            <h3 class="text-xl font-bold mb-2 flex items-center space-x-2 text-white"><i data-lucide="file-spreadsheet" class="text-indigo-500"></i><span>Import File CSV</span></h3>
            <div class="flex justify-between items-center mb-6 gap-2">
                <p class="text-xs text-slate-400 font-mono bg-slate-900 p-2 rounded border border-slate-800 flex-grow">name, sn, category, location, user, email, loan, warranty, purchase</p>
                <button onclick="downloadTemplate()" class="bg-slate-800 hover:bg-slate-700 text-sky-400 p-2.5 rounded-xl border border-slate-700" title="Download Template"><i data-lucide="file-down" class="w-5 h-5"></i></button>
            </div>
            <div id="drop-zone" class="drop-zone rounded-2xl py-12 flex flex-col items-center cursor-pointer hover:border-sky-500 transition mb-6 bg-slate-800/50" onclick="document.getElementById('csv-input').click()">
                <div class="bg-slate-800 p-3 rounded-full mb-3"><i data-lucide="cloud-upload" class="w-8 h-8 text-sky-500"></i></div>
                <p class="text-xs font-bold text-slate-300" id="file-label">Klik atau seret file CSV ke sini</p>
                <input type="file" id="csv-input" accept=".csv" class="hidden" onchange="handleCSV(event)">
            </div>
            <div class="flex gap-3"><button onclick="closeModal('import-modal')" class="flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold text-xs">Batal</button><button id="btn-import" onclick="processCSV()" disabled class="flex-1 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black text-xs opacity-50 cursor-not-allowed">Mulai Import</button></div>
        </div>
    </div>

    <!-- Notification & Toast -->
    <div id="notification-modal" class="modal-bg fixed inset-0 flex items-center justify-center hidden p-4 z-[3000]"><div class="card p-6 rounded-3xl max-w-lg w-full modal-content border-slate-700 shadow-2xl relative"><div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-4"><h3 class="text-lg font-bold text-white flex items-center gap-2"><i data-lucide="bell-ring" class="text-amber-500 w-5 h-5"></i> Peringatan Garansi</h3><button onclick="closeModal('notification-modal')" class="text-slate-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button></div><div id="warranty-list-full" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar"></div></div></div>
    <div id="toast" class="fixed bottom-10 right-10 p-4 rounded-2xl bg-slate-800 text-white font-bold shadow-2xl border border-slate-700 transition-all duration-500 opacity-0 translate-y-10 z-[3000] flex items-center space-x-3"><div id="toast-icon-bg" class="p-2 rounded-lg bg-sky-500/20 text-sky-500"><i id="toast-icon" data-lucide="check" class="w-5 h-5"></i></div><span id="toast-msg" class="text-sm">Notifikasi</span></div>

    <script>
        const API = "https://arief0rahman.pythonanywhere.com/api";
        let localData = [], filteredData = [], currentPage = 1, itemsPerPage = 15, chartInstance = null, repChartInstances = {}, currentUser = null, csvContent = "";

        // --- AUTH & MOCK LOGIN ---
        document.getElementById('login-form').onsubmit = async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            try {
                const res = await fetch(`${API}/login`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username, password}) });
                const data = await res.json();
                if (res.ok) { localStorage.setItem('myit_token', data.token); localStorage.setItem('myit_user', JSON.stringify(data.user)); initApp(data.user); } 
                else { document.getElementById('login-error').textContent = data.error; document.getElementById('login-error').classList.remove('hidden'); }
            } catch(e) { console.error(e); }
        };

        function mockLogin(type) {
            let mockUser = type === 'google' ? { username: "google_staff", role: "editor" } : { username: "sso_viewer", role: "viewer" };
            mockUser.created_at = new Date().toISOString();
            localStorage.setItem('myit_token', 'mock_token_' + type); localStorage.setItem('myit_user', JSON.stringify(mockUser));
            setTimeout(() => initApp(mockUser), 500);
            showToast(`Login ${type.toUpperCase()} Berhasil`);
        }

        function logout() { localStorage.removeItem('myit_token'); localStorage.removeItem('myit_user'); location.reload(); }
        function checkAuth() { const t = localStorage.getItem('myit_token'), u = localStorage.getItem('myit_user'); if(t && u) initApp(JSON.parse(u)); else document.getElementById('login-page').classList.remove('hidden'); }
        
        function initApp(user) {
            currentUser = user;
            document.getElementById('login-page').classList.add('hidden'); document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('user-name').textContent = user.username; document.getElementById('user-initial').textContent = user.username.charAt(0).toUpperCase(); document.getElementById('current-user-role').textContent = user.role;
            const sa = document.querySelectorAll('.role-superadmin'), ed = document.querySelectorAll('.role-editable');
            if(user.role === 'superadmin') { sa.forEach(e=>e.classList.remove('hidden')); ed.forEach(e=>e.classList.remove('hidden')); }
            else if(user.role === 'editor') ed.forEach(e=>e.classList.remove('hidden'));
            loadDashboard(); lucide.createIcons();
        }

        function authFetch(url, opt={}) { if(!opt.headers) opt.headers={}; opt.headers['Authorization'] = localStorage.getItem('myit_token'); return fetch(url, opt); }
        
        // --- NAVIGATION ---
        function switchView(view) {
            ['dashboard', 'assets', 'users', 'report'].forEach(v => { 
                const el = document.getElementById(`view-${v}`);
                const btn = document.getElementById(`nav-${v}`);
                if(el) el.classList.add('hidden');
                if(btn) { btn.classList.remove('active-nav', 'text-white', 'bg-sky-600'); btn.classList.add('text-slate-400'); }
            });
            document.getElementById(`view-${view}`).classList.remove('hidden');
            const activeBtn = document.getElementById(`nav-${view}`);
            if(activeBtn) { activeBtn.classList.add('active-nav', 'text-white'); activeBtn.classList.remove('text-slate-400'); }
            document.getElementById('page-title').textContent = view==='users'?'Manajemen User':(view==='assets'?'Data Aset':(view==='report'?'Laporan Analisis':'Dashboard'));
            if(view==='assets') fetchAssets(); if(view==='users') fetchUsers(); if(view==='dashboard') loadDashboard(); if(view==='report') loadReport();
        }

        // --- DASHBOARD ---
        async function loadDashboard() {
            try {
                const res = await authFetch(`${API}/dashboard`); const data = await res.json();
                animateValue('stat-total', 0, data.total, 1000);
                renderChart(data.categories);
                const list = document.getElementById('warranty-list-dashboard'), badge = document.getElementById('notif-badge'), full = document.getElementById('warranty-list-full');
                if(data.warranty_alerts.length > 0) {
                    badge.textContent = data.warranty_alerts.length; badge.classList.remove('hidden');
                    const html = data.warranty_alerts.map(i => `<div class="flex justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700/50"><div><div class="font-bold text-slate-200 text-xs">${i.name}</div><div class="text-[9px] text-slate-500 font-mono">${i.serial_number}</div></div><div class="text-right text-xs font-bold text-amber-500">${i.days_left} Hari</div></div>`).join('');
                    list.innerHTML = html; full.innerHTML = html;
                } else { list.innerHTML = '<div class="text-center text-slate-500 text-sm py-10">Aman.</div>'; badge.classList.add('hidden'); }
            } catch(e){}
        }

        // --- REPORT LOGIC ---
        async function loadReport() {
            if(localData.length === 0) await fetchAssets();
            // 1. KPIs
            const total = localData.length;
            const disposed = localData.filter(i => i.status === 'Disposed').length;
            const valuation = total * 5000000; // Dummy valuation
            const risk = localData.filter(i => {
                if(!i.warranty_date) return false;
                const diff = new Date(i.warranty_date) - new Date();
                return diff > 0 && diff < (30 * 24 * 3600 * 1000);
            }).length;

            animateValue('rep-total', 0, total, 1000);
            animateValue('rep-disposed', 0, disposed, 1000);
            animateValue('rep-warranty', 0, risk, 1000);
            document.getElementById('rep-value').textContent = `Rp ${(valuation/1000000000).toFixed(1)} M`;

            // 2. Insights
            const cats = {}; const locs = {};
            localData.forEach(i => { cats[i.category] = (cats[i.category]||0)+1; locs[i.location] = (locs[i.location]||0)+1; });
            const topCat = Object.keys(cats).reduce((a,b)=>cats[a]>cats[b]?a:b, '-');
            const topLoc = Object.keys(locs).reduce((a,b)=>locs[a]>locs[b]?a:b, '-');
            const healthy = localData.filter(i => i.status === 'In Use').length;
            
            document.getElementById('insight-cat').textContent = topCat;
            document.getElementById('insight-health').textContent = `${Math.round((healthy/total)*100)}%`;
            document.getElementById('insight-loc').textContent = topLoc;

            // 3. Charts
            renderReportCharts(cats);
        }

        // --- ASSETS ---
        async function fetchAssets() { try { const res = await authFetch(`${API}/assets`); localData = await res.json(); filteredData = localData; renderTable(); } catch(e){} }
        function renderTable() {
            const list = document.getElementById('assets-list'), start = (currentPage-1)*itemsPerPage, pageData = filteredData.slice(start, start+itemsPerPage);
            document.getElementById('curr-page').textContent = currentPage;
            list.innerHTML = pageData.map(a => `
                <tr class="hover:bg-slate-800/40 border-b border-slate-800/50">
                    <td class="p-6"><div class="font-bold text-white text-sm">${a.name}</div><div class="text-[10px] text-slate-500 font-mono">${a.serial_number}</div></td>
                    <td class="p-6"><span class="px-2 py-1 bg-slate-800 rounded text-[10px] text-slate-300 font-bold uppercase">${a.category}</span></td>
                    <td class="p-6"><div class="text-xs text-slate-300">${a.location}</div><div class="text-[10px] text-slate-500">${a.user||'-'}</div>${a.user_email?`<div class="text-[9px] text-sky-500/70">${a.user_email}</div>`:''}</td>
                    <td class="p-6 text-center"><span class="px-3 py-1 ${a.status==='In Use'?'bg-emerald-500/10 text-emerald-400':(a.status==='Broken'?'bg-red-500/10 text-red-400':'bg-slate-500/10 text-slate-400')} rounded-full text-[10px] font-bold uppercase">${a.status}</span></td>
                    <td class="p-6 text-right role-editable ${currentUser.role==='viewer'?'hidden':''}"><button onclick="openEdit('${a.id}')" class="p-2 bg-indigo-500/20 text-indigo-400 rounded"><i data-lucide="edit-2" class="w-4 h-4"></i></button><button onclick="deleteAsset('${a.id}')" class="p-2 bg-red-500/20 text-red-400 rounded ml-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                </tr>`).join('');
            lucide.createIcons();
        }

        // --- CRUD & CSV Helpers ---
        function openEdit(id) {
            const a = localData.find(x => x.id === id);
            ['id','name','sn','category','location','user','email','status','purchase-date','loan-date','warranty-date'].forEach(k => document.getElementById(`edit-${k}`).value = a[k.replace('-','_')] || '');
            document.getElementById('modal-title').textContent = "Edit Aset"; openModal('edit-modal');
        }
        document.getElementById('asset-form').onsubmit = async (e) => {
            e.preventDefault(); const id = document.getElementById('edit-id').value;
            const body = {}; ['name','sn','category','location','user','email','purchase-date','loan-date','warranty-date','status'].forEach(k => body[k.replace('-','_')] = document.getElementById(`edit-${k}`).value);
            body['serial_number'] = body['sn']; body['user_email'] = body['email'];
            await authFetch(`${API}/assets${id ? '/'+id : ''}`, { method: id?'PUT':'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
            closeModal('edit-modal'); fetchAssets(); showToast("Data Disimpan");
        }
        async function deleteAsset(id) { if(confirm("Hapus?")) { await authFetch(`${API}/assets/${id}`, { method:'DELETE'}); fetchAssets(); } }
        
        function handleCSV(e) { const f=e.target.files[0]; if(!f)return; document.getElementById('file-label').textContent=f.name; const r=new FileReader(); r.onload=ev=>{csvContent=ev.target.result;document.getElementById('btn-import').disabled=false; document.getElementById('btn-import').classList.remove('opacity-50','cursor-not-allowed');}; r.readAsText(f); }
        async function processCSV() { if(!csvContent)return; const l=csvContent.split('\n'); let s=0; const start=(l[0].toLowerCase().includes('name'))?1:0; for(let i=start;i<l.length;i++){ const c=l[i].split(','); if(c.length<2)continue; try{ await authFetch(`${API}/assets`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name:c[0]?.trim(), serial_number:c[1]?.trim(), category:c[2]?.trim()||'Other', location:c[3]?.trim()||'Gudang', user:c[4]?.trim()||'', user_email:c[5]?.trim()||'', loan_date:c[6]?.trim()||'', warranty_date:c[7]?.trim()||'', purchase_date:c[8]?.trim()||''}) }); s++; }catch(e){} } closeModal('import-modal'); showToast(`Import: ${s} data`); fetchAssets(); }
        function downloadTemplate() { const csv = "name,serial_number,category,location,user,user_email,loan_date,warranty_date,purchase_date\nLaptop Dell,SN123,Laptop,Lantai 1,Budi,budi@email.com,2023-01-01,2024-01-01,2022-12-31"; const link=document.createElement('a'); link.href='data:text/csv;charset=utf-8,'+encodeURI(csv); link.download='template.csv'; link.click(); }
        function exportCSV(mode='all') { let d=localData; let c="Name,Serial,Category,Location,User,Email,Status\n"; d.forEach(r=>{c+=`"${r.name}","${r.serial_number}","${r.category}","${r.location}","${r.user||''}","${r.user_email||''}","${r.status}"\n`}); const l=document.createElement('a'); l.href='data:text/csv;charset=utf-8,'+encodeURI(c); l.download=`export.csv`; l.click(); }

        // --- USER MGMT (Superadmin) ---
        async function fetchUsers() { const res = await authFetch(`${API}/users`); const users = await res.json(); document.getElementById('users-list').innerHTML = users.map(u => `<tr class="border-b border-slate-800/50"><td class="p-5 font-bold text-white">${u.username}</td><td class="p-5"><span class="px-2 py-1 bg-purple-900/30 text-purple-400 rounded text-xs uppercase">${u.role}</span></td><td class="p-5 text-right">${u.role!=='superadmin'?`<button onclick="deleteUser('${u.id}')" class="text-red-400 hover:text-white"><i data-lucide="trash-2" class="w-4 h-4"></i></button>`:''}</td></tr>`).join(''); lucide.createIcons(); }
        document.getElementById('user-form').onsubmit = async (e) => { e.preventDefault(); const body={username:document.getElementById('new-username').value,password:document.getElementById('new-password').value,role:document.getElementById('new-role').value}; await authFetch(`${API}/users`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)}); fetchUsers(); };
        async function deleteUser(id) { if(confirm("Hapus user?")) { await authFetch(`${API}/users/${id}`, {method:'DELETE'}); fetchUsers(); } }

        // --- GENERIC UTILS ---
        function openModal(id, isAdd=false) { document.getElementById(id).classList.remove('hidden'); if(isAdd){ document.getElementById('asset-form').reset(); document.getElementById('edit-id').value=""; document.getElementById('modal-title').textContent="Tambah Aset"; } setTimeout(()=>document.querySelector(`#${id} .modal-content`).classList.add('modal-open'),10); }
        function closeModal(id) { document.querySelector(`#${id} .modal-content`).classList.remove('modal-open'); setTimeout(()=>document.getElementById(id).classList.add('hidden'),300); }
        function showToast(m, t='success') { const x=document.getElementById('toast'); document.getElementById('toast-msg').textContent=m; document.getElementById('toast-icon-bg').className=`p-2 rounded-lg ${t==='error'?'bg-red-500/20 text-red-500':'bg-emerald-500/20 text-emerald-500'}`; x.classList.remove('opacity-0','translate-y-10'); setTimeout(()=>x.classList.add('opacity-0','translate-y-10'),3000); }
        function filterAssets() { const q=document.getElementById('search-input').value.toLowerCase(); filteredData=localData.filter(a=>a.name.toLowerCase().includes(q)||a.serial_number.toLowerCase().includes(q)||(a.user&&a.user.toLowerCase().includes(q))); currentPage=1; renderTable(); }
        function nextPage() { currentPage++; renderTable(); } function prevPage() { currentPage--; renderTable(); }
        function renderChart(cat) { const ctx=document.getElementById('categoryChart').getContext('2d'); if(chartInstance)chartInstance.destroy(); chartInstance=new Chart(ctx,{type:'doughnut',data:{labels:Object.keys(cat),datasets:[{data:Object.values(cat),backgroundColor:['#0ea5e9','#6366f1','#8b5cf6','#d946ef','#f43f5e','#f59e0b','#10b981'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#94a3b8'}}}}}); }
        function renderReportCharts(cat) { 
            const ctx1=document.getElementById('repChartCat').getContext('2d'); if(repChartInstances['cat'])repChartInstances['cat'].destroy(); repChartInstances['cat']=new Chart(ctx1,{type:'doughnut',data:{labels:Object.keys(cat),datasets:[{data:Object.values(cat),backgroundColor:['#14b8a6','#0ea5e9','#6366f1','#8b5cf6','#f59e0b'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#94a3b8'}}}}});
            
            // Status Chart
            const stat={}; localData.forEach(i=>stat[i.status]=(stat[i.status]||0)+1);
            const ctx2=document.getElementById('repChartStat').getContext('2d'); if(repChartInstances['stat'])repChartInstances['stat'].destroy(); repChartInstances['stat']=new Chart(ctx2,{type:'bar',data:{labels:Object.keys(stat),datasets:[{label:'Jml',data:Object.values(stat),backgroundColor:'#3b82f6',borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#334155'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}});

            // Trend Chart
            const years={}; localData.forEach(i=>{if(i.purchase_date){const y=i.purchase_date.substring(0,4); years[y]=(years[y]||0)+1;}});
            const sortedYears=Object.keys(years).sort(); const counts=sortedYears.map(y=>years[y]);
            const ctx3=document.getElementById('repChartTrend').getContext('2d'); if(repChartInstances['trend'])repChartInstances['trend'].destroy(); repChartInstances['trend']=new Chart(ctx3,{type:'line',data:{labels:sortedYears,datasets:[{label:'Pembelian',data:counts,borderColor:'#6366f1',backgroundColor:'rgba(99,102,241,0.1)',fill:true,tension:0.4}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{grid:{color:'#334155'}},x:{grid:{display:false}}},plugins:{legend:{display:false}}}});
        }
        function animateValue(id,s,e,d){ let o=document.getElementById(id); if(!o)return; let st=null; const step=ts=>{if(!st)st=ts; const p=Math.min((ts-st)/d,1); o.innerHTML=Math.floor(p*(e-s)+s); if(p<1)window.requestAnimationFrame(step);}; window.requestAnimationFrame(step); }

        window.onload = checkAuth;
    </script>
</body>
</html>